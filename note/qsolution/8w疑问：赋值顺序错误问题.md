# Centroids的计算中出现的赋值问题

## 1. 问题表现：

程序`computeCentroids.m`：  

	temp = zeros(K, n);
	cnum = zeros(K,1);
	
	for j = 1:K
		for i = 1:size(X,1)
			if idx(i) == j
				temp(j,:) = temp(j,:)  + X(i,:);
				cnum(j) = cnum(j) + 1;
			end
		end	
		centroids(j,:) = temp(j,:) ./ cnum(j); % not temp(j,:) = ...
	end

以上代码中， 

	centroids(j,:) = temp(j,:) ./ cnum(j);  

这一行中的`centroids(j,:) = `，一开始写的是`temp(j,:) =`最后赋值。  

代码是：  

	temp = zeros(K, n);
	cnum = zeros(K,1);
	
	for j = 1:K
		for i = 1:size(X,1)
			if idx(i) == j
				temp(j,:) = temp(j,:)  + X(i,:);
				cnum(j) = cnum(j) + 1;
			end
		end	
		temp(j,:) = temp(j,:) ./ cnum(j); % not temp(j,:) = ...
	end
	
	centroids = temp(:);

结果表现得非常奇怪：  

![](http://7xotr7.com1.z0.glb.clouddn.com/16-5-12/37734396.jpg)

理想结果是：  

![](http://7xotr7.com1.z0.glb.clouddn.com/16-5-12/82115511.jpg)  

本来的计算过程是：在每次j的情况下，计算平均值（求和，计数cnum，用和除以计数cnum）。  

---  
## 2. 问题定位

### 2.1 逐步打印法：  

去掉外围的j循环，直接令j=1、2、3，逐步打印结果。就是说，第一次运行时，j=1。第二次运行前，修改j=2，……以这样的步骤，每次记结果。  

在`temp(:)`下：

j=1:

![](http://7xotr7.com1.z0.glb.clouddn.com/16-5-12/87076579.jpg)

j=2:  

![](http://7xotr7.com1.z0.glb.clouddn.com/16-5-12/18954861.jpg)

j=3:  

![](http://7xotr7.com1.z0.glb.clouddn.com/16-5-12/53153108.jpg)

赋值结果是乱的。找不到原因。

### 2.2 使用octave的debug方法：  

改用debug，使用这些菜单功能：  

![](http://7xotr7.com1.z0.glb.clouddn.com/16-5-12/48894956.jpg)

#### 2.2.1  `centroids(j,:) = `分步骤结果是：  

初始值是3*2的0矩阵：  
![](http://7xotr7.com1.z0.glb.clouddn.com/16-5-12/88518664.jpg)   

j=1运行结束之后，填充第一行平均值：  
![](http://7xotr7.com1.z0.glb.clouddn.com/16-5-12/52593077.jpg)   

j=2运行结束之后，填充第二行平均值： 
![](http://7xotr7.com1.z0.glb.clouddn.com/16-5-12/72801982.jpg)    

j=3运行结束之后，填充第三行平均值：
![](http://7xotr7.com1.z0.glb.clouddn.com/16-5-12/15114733.jpg)  

#### 2.2.2  `temp(j,:) = `分步骤结果是：  

如果是`temp(j,:) =`，分步骤结果是：  

初始值是3*2的0矩阵： 
![](http://7xotr7.com1.z0.glb.clouddn.com/16-5-12/15735926.jpg)  
未记平均值。 

j=1运行结束之后，填充第一行平均值：  
![](http://7xotr7.com1.z0.glb.clouddn.com/16-5-12/58846607.jpg)  

j=2运行结束后，未记平均值：  
![](http://7xotr7.com1.z0.glb.clouddn.com/16-5-12/13072894.jpg)  

记平均值：  
![](http://7xotr7.com1.z0.glb.clouddn.com/16-5-12/55793259.jpg)  

j=3运行结束后，未记平均值：  
![](http://7xotr7.com1.z0.glb.clouddn.com/16-5-12/57640451.jpg)   

记平均值：  
![](http://7xotr7.com1.z0.glb.clouddn.com/16-5-12/38773791.jpg)  

**可以看到，到目前为止，都没有问题。**

运行这一句：  

![](http://7xotr7.com1.z0.glb.clouddn.com/16-5-12/91584422.jpg)  

运行结果是：  

![](http://7xotr7.com1.z0.glb.clouddn.com/16-5-12/71370033.jpg)  

赋值过程出了问题，顺序完全不对。  

*比较奇怪的是：submit居然通过。但是运行ex7后续程序则无法进行……*

## 3. 问题分析与解决：  

现在可以确定，肯定是这一句写错了：  

	centroids = temp(:);  

改成这样的：  

	centroids = temp(:,:); 

赋值过程变成这样了：  

![](http://7xotr7.com1.z0.glb.clouddn.com/16-5-12/31375756.jpg) 

一致了。  

还是数组维度问题。  

在`temp(:)`中，赋值过程是先列后行，而不是我以为的先行后列，所以出现这么奇怪的结果。   
换成了`temp(:,:)`，就完全没问题了。因为指定了严格按照行、列来。  

以前诸多代码中，只写一个`(:)`之所以能不出错，应该是一维问题，都是向量，无论行向量还是列向量，都无所谓了。  

结论：程序自带debug的话，debug还是比逐步打印有作用的。  